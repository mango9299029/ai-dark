<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>เครื่องคิดเลขสลับโหมดได้</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap');
  :root {
    --bg-dark: #121217;
    --panel-dark: #1e1f29;
    --accent: #7c5cff;
    --text-light: #e1e2e7;
    --text-muted: #888ba7;
    --btn-bg: #2a2c3d;
    --btn-hover: #3b3f58;
    --shadow: rgba(124, 92, 255, 0.4);
  }
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 0;
    background: var(--bg-dark);
    font-family: 'Poppins', sans-serif;
    color: var(--text-light);
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    padding: 20px;
    user-select: none;
  }
  .container {
    display: flex;
    gap: 30px;
    max-width: 1000px;
    width: 100%;
  }
  .calculator {
    background: var(--panel-dark);
    border-radius: 18px;
    box-shadow: 0 10px 30px var(--shadow);
    padding: 25px 30px;
    flex: 1 1 480px;
    display: flex;
    flex-direction: column;
  }
  .display-container {
      position: relative;
  }
  .display {
    background: #222431;
    border-radius: 14px;
    padding: 20px 25px;
    font-size: 2.6rem;
    font-weight: 700;
    letter-spacing: 1.2px;
    color: var(--text-light);
    min-height: 90px;
    text-align: right;
    overflow-wrap: break-word;
    box-shadow: inset 0 0 10px rgba(124, 92, 255, 0.3);
    margin-bottom: 24px;
    word-break: break-all;
    display: flex;
    justify-content: flex-end;
    align-items: center;
  }
  .buttons {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
  }
  .buttons.sci-mode {
      grid-template-columns: repeat(7, 1fr);
  }
  button {
    background: var(--btn-bg);
    border: none;
    border-radius: 14px;
    font-size: 1.4rem;
    font-weight: 600;
    color: var(--text-light);
    padding: 18px 0;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(124, 92, 255, 0.2);
    transition:
      background 0.3s ease,
      box-shadow 0.3s ease,
      transform 0.15s ease;
    user-select: none;
  }
  button:hover {
    background: var(--btn-hover);
    box-shadow: 0 6px 20px var(--shadow);
  }
  button:active {
    transform: scale(0.96);
  }
  .operator {
    background: linear-gradient(135deg, #7c5cff, #6150d8);
    box-shadow: 0 4px 12px #7c5cff88;
  }
  .operator:hover {
    background: linear-gradient(135deg, #a18eff, #7c5cff);
    box-shadow: 0 8px 25px #a18effbb;
  }
  .equal {
    grid-column: span 1;
    background: #4e57ff;
    font-weight: 700;
    box-shadow: 0 6px 16px #4e57ffbb;
  }
  .equal:hover {
    background: #6677ff;
    box-shadow: 0 8px 28px #6677ffcc;
  }
  .zero {
    grid-column: span 2;
  }
  
  /* Mode-specific styles */
  .mode-toggle-btn {
    position: absolute;
    top: 5px;
    left: 5px;
    background: var(--accent);
    color: var(--text-light);
    border: none;
    border-radius: 8px;
    padding: 8px 12px;
    font-size: 0.8rem;
    cursor: pointer;
    z-index: 10;
  }
  .hidden {
      display: none !important;
  }
  .sci-btn {
      font-size: 1rem;
      padding: 12px 0;
  }
  .buttons.sci-mode .zero {
      grid-column: span 1;
  }
  .buttons.sci-mode .equal {
      grid-column: 7;
      grid-row: 5 / 7;
      height: 100%;
  }

  /* History Panel */
  .history-panel {
    background: var(--panel-dark);
    border-radius: 18px;
    box-shadow: 0 10px 30px var(--shadow);
    width: 350px;
    padding: 20px 25px;
    display: flex;
    flex-direction: column;
    max-height: 600px;
  }
  .history-header {
    font-weight: 700;
    font-size: 1.6rem;
    margin-bottom: 14px;
    color: var(--accent);
    user-select: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .history-list {
    overflow-y: auto;
    flex-grow: 1;
    scrollbar-width: thin;
    scrollbar-color: var(--accent) transparent;
  }
  .history-list::-webkit-scrollbar {
    width: 8px;
  }
  .history-list::-webkit-scrollbar-track {
    background: transparent;
  }
  .history-list::-webkit-scrollbar-thumb {
    background-color: var(--accent);
    border-radius: 10px;
  }
  .history-item {
    background: #2f3249;
    border-radius: 14px;
    padding: 14px 18px;
    margin-bottom: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
    user-select: text;
    cursor: pointer;
  }
  .history-item:hover {
      background: #414561;
  }
  .history-expression {
    color: var(--text-muted);
    font-size: 1rem;
    flex: 1 1 auto;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
  }
  .history-result {
    font-weight: 700;
    font-size: 1.1rem;
    min-width: 80px;
    text-align: right;
    color: var(--accent);
    user-select: text;
  }
  .history-actions {
    display: flex;
    gap: 8px;
  }
  .history-actions button {
    background: transparent;
    border: 1.5px solid var(--accent);
    padding: 6px 10px;
    font-size: 0.85rem;
    border-radius: 12px;
    color: var(--accent);
    transition: background 0.3s ease, color 0.3s ease;
    cursor: pointer;
  }
  .history-actions button:hover {
    background: var(--accent);
    color: #121217;
  }
  /* Controls */
  .controls {
    margin-top: 14px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .controls button {
    background: transparent;
    border: 1.5px solid var(--accent);
    padding: 8px 14px;
    font-size: 0.9rem;
    border-radius: 14px;
    color: var(--accent);
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s ease, color 0.3s ease;
  }
  .controls button:hover {
    background: var(--accent);
    color: #121217;
  }
  .search-input {
    flex-grow: 1;
    margin-right: 10px;
    background: #222431;
    border: none;
    border-radius: 14px;
    padding: 8px 14px;
    font-size: 1rem;
    color: var(--text-light);
    box-shadow: inset 0 0 6px rgba(124, 92, 255, 0.3);
    transition: background 0.3s ease;
  }
  .search-input::placeholder {
    color: var(--text-muted);
  }
  .search-input:focus {
    outline: none;
    background: #333651;
  }
  /* Responsive */
  @media (max-width: 860px) {
    .container {
      flex-direction: column;
      align-items: center;
    }
    .history-panel {
      width: 100%;
      max-height: 300px;
      margin-top: 24px;
    }
    .calculator {
      width: 100%;
      max-width: 480px;
    }
    .buttons.sci-mode {
      grid-template-columns: repeat(5, 1fr);
    }
  }
</style>
</head>
<body>
  <div class="container" role="main" aria-label="เครื่องคิดเลขธีมมืดพร้อมประวัติ">
    <section class="calculator" aria-label="เครื่องคิดเลข">
      <div class="display-container">
        <button id="modeToggleBtn" class="mode-toggle-btn">Sci</button>
        <div class="display" id="display" aria-live="polite" aria-atomic="true">0</div>
      </div>
      <div class="buttons" id="buttons" role="group" aria-label="ปุ่มเครื่องคิดเลข">
        <button type="button" data-value="C" class="std-btn clear">C</button>
        <button type="button" data-value="bk" class="std-btn">⌫</button>
        <button type="button" data-value="pc" aria-label="เปอร์เซ็นต์" class="std-btn">%</button>
        <button type="button" data-value="/" aria-label="หาร" class="operator std-btn">÷</button>
        <button type="button" data-value="7" class="std-btn">7</button>
        <button type="button" data-value="8" class="std-btn">8</button>
        <button type="button" data-value="9" class="std-btn">9</button>
        <button type="button" data-value="*" aria-label="คูณ" class="operator std-btn">×</button>
        <button type="button" data-value="4" class="std-btn">4</button>
        <button type="button" data-value="5" class="std-btn">5</button>
        <button type="button" data-value="6" class="std-btn">6</button>
        <button type="button" data-value="-" aria-label="ลบ" class="operator std-btn">−</button>
        <button type="button" data-value="1" class="std-btn">1</button>
        <button type="button" data-value="2" class="std-btn">2</button>
        <button type="button" data-value="3" class="std-btn">3</button>
        <button type="button" data-value="+" aria-label="บวก" class="operator std-btn">+</button>
        <button type="button" data-value="0" class="zero std-btn">0</button>
        <button type="button" data-value="." class="std-btn">.</button>
        <button type="button" data-value="=" class="equal std-btn" aria-label="เท่ากับ">=</button>
        
        <button type="button" data-value="(" class="hidden sci-btn">(</button>
        <button type="button" data-value=")" class="hidden sci-btn">)</button>
        <button type="button" data-value="sin" class="hidden sci-btn">sin</button>
        <button type="button" data-value="cos" class="hidden sci-btn">cos</button>
        <button type="button" data-value="tan" class="hidden sci-btn">tan</button>
        <button type="button" data-value="log" class="hidden sci-btn">log</button>
        <button type="button" data-value="ln" class="hidden sci-btn">ln</button>
        <button type="button" data-value="sqrt" class="hidden sci-btn">√</button>
        <button type="button" data-value="x2" class="hidden sci-btn">x²</button>
        <button type="button" data-value="pi" class="hidden sci-btn">π</button>
      </div>
    </section>
    <aside class="history-panel" aria-label="ประวัติการคำนวณ">
      <div class="history-header">
        ประวัติ
      </div>
      <div class="history-list" id="calc-history" tabindex="0"></div>
      <div class="controls">
        <input type="search" placeholder="ค้นหา..." aria-label="ค้นหาประวัติ" class="search-input" id="search" />
        <button type="button" id="clearHistory">ลบทั้งหมด</button>
      </div>
    </aside>
  </div>

<script>
var cnCInputs=[0],cnHistory=[],cnHistoryShow=3,cnDegreeRadians="degree",cnAccuracy=12,cnNew=!0,cnMemoryV=0,cnScreenV=0,cnPrevAns=0;
function switchRadio(r){cnDegreeRadians=r}
function r(r){if(cnCInputs.length<2&&cnNew&&"1/x"!=r&&"x3"!=r&&"x2"!=r&&"apow"!=r&&"pow"!=r&&"*"!=r&&"/"!=r&&"+"!=r&&"-"!=r&&"neg"!=cnCInputs[0]&&(cnCInputs=[0]),"-"==r&&cnCInputs.length<2&&0==cnCInputs[0]&&(cnCInputs[0]="neg"),"MR"!=r&&(document.getElementById("calc-mrc").innerHTML="MR"),"M+"==r)"Error"==cnScreenV||isNaN(cnScreenV)||(cnMemoryV+=parseFloat(cnScreenV+""));else if("M-"==r)"Error"==cnScreenV||isNaN(cnScreenV)||(cnMemoryV-=parseFloat(cnScreenV+""));else if("MR"==r)"MC"==document.getElementById("calc-mrc").innerHTML?(cnMemoryV=0,document.getElementById("calc-mrc").innerHTML="MR"):(1<cnCInputs.length?"pi"!=(e=cnCInputs[cnCInputs.length-1])&&"e"!=e&&"."!=e&&isNaN(e)?cnCInputs.push(cnMemoryV):0!=cnMemoryV&&(cnCInputs.push("*"),cnCInputs.push(cnMemoryV)):cnCInputs=[cnMemoryV],cnScreenV=cnCalcFinal(0),document.getElementById("calc-mrc").innerHTML="MC");else if("ans"==r)1<cnCInputs.length?"pi"!=(e=cnCInputs[cnCInputs.length-1])&&"e"!=e&&"."!=e&&isNaN(e)?"neg"!=e&&cnCInputs.push(cnPrevAns):(cnCInputs.push("*"),cnCInputs.push(cnPrevAns)):cnCInputs=[cnPrevAns],cnScreenV=cnCalcFinal(0);else if("="==r){if(1<cnCInputs.length){"Error"==(cnScreenV=cnCalcFinal(1))||isNaN(cnScreenV)?cnCInputs=[0]:(cnCInputs=[cnScreenV],cnPrevAns=cnScreenV);var c="";for(i=cnHistory.length-1;0<=i;i--)c+="<div>"+cnHistory[i][0]+" = "+cnHistory[i][1]+"</div>";document.getElementById("calc-history").innerHTML=c}cnNew=!0}else{var e;cnScreenV="C"==r?(cnCInputs=[0],document.getElementById("display").innerHTML="0",document.getElementById("calc-input").innerHTML="&nbsp;",cnNew=!0,0):("bk"==r?(cnCInputs.splice(cnCInputs.length-1,1),0==cnCInputs.length&&(cnCInputs=[0])):("RND"==r?(r=Math.random()+"",cnCInputs.length<2?"neg"==cnCInputs[0]?cnCInputs.push(r):cnCInputs[0]=r:"+/-"!=(e=cnCInputs[cnCInputs.length-1])&&"."!=e&&isNaN(e)&&cnCInputs.push(r),cnNew=!1):cnCInputs.push(r),e=cnValidateInputs(),r=cnCInputs.length,1==e?cnCInputs.splice(r-1,1):-1==e&&cnCInputs.splice(r-2,1)),cnCalcFinal(0))}}
function cnCalcFinal(r){var c=cnCombineNumbers(),e=[],n=[],a=0;for(i=0;i<c.length;i++)A=c[i],B=c[i-1],isNaN(A)&&"sin"!=A&&"cos"!=A&&"tan"!=A&&"asin"!=A&&"acos"!=A&&"atan"!=A&&"ex"!=A&&"10x"!=A&&"ln"!=A&&"log"!=A&&"3x"!=A&&"sqrt"!=A&&"("!=A&&"pi"!=A&&"e"!=A||isNaN(B)&&"1/x"!=B&&"pc"!=B&&"n!"!=B&&"x3"!=B&&"x2"!=B&&")"!=B&&"pi"!=B&&"e"!=B||(n.push("*"),e.push("*")),"sin"==A||"cos"==A||"tan"==A||"asin"==A||"acos"==A||"atan"==A||"ln"==A||"log"==A||"3x"==A||"sqrt"==A?(n.push(A),n.push("("),e.push(A),e.push("("),a++):("("==A&&a++,")"==A&&a--,n.push(A),e.push(A));if(0<a)for(i=0;i<a;i++)e.push("<b>)</b>"),n.push(")");2<n.length&&"0"==n[0]+""&&"*"==n[1]&&("sin"!=(A=n[2])&&"cos"!=A&&"tan"!=A&&"asin"!=A&&"acos"!=A&&"atan"!=A&&"ex"!=A&&"10x"!=A&&"ln"!=A&&"log"!=A&&"("!=A&&"pi"!=A&&"e"!=A&&"3x"!=A&&"sqrt"!=A||(n=n.slice(2),e=e.slice(2)));for(var o=e,t=[],s=0,p=0;-1<o.indexOf(")")||-1<o.indexOf("<b>)</b>");){var s=o.indexOf(")"),y=o.indexOf("<b>)</b>");-1<s&&!(-1<y&&y<s)||(s=y),o=cnArrayProc(o,p=(t=o.slice(0,s+1)).lastIndexOf("("),s+1,cnFormatDisplay(t=t.slice(p)))}for(var u="&nbsp;"+cnFormatDisplay(o),o=n,t=[],p=s=0;-1<o.indexOf(")");)s=o.indexOf(")"),o=cnArrayProc(o,p=(t=o.slice(0,s+1)).lastIndexOf("("),s+1,cnCalcResult(t=t.slice(p)));var l=cnCalcResult(o);return isNaN(l)&&(l=1!=r?"":"Error"),document.getElementById("display").innerHTML=u,1==r&&(u=u.replace(/<b>/g,"").replace(/<\/b>/g,""),1<c.length&&(cnHistory.push([u,cnFmt(l)]),cnHistory.length>cnHistoryShow&&cnHistory.splice(0,1)),u+=" ="),cnRenderHistory(),l}
function cnFormatDisplay(r){for(var c=r;-1<c.indexOf("EXP");)var e=c.indexOf("EXP"),c="neg"==c[e+1]?cnArrayProc(c,e,e+2," &#215; 10<sup>-</sup>"):isNaN(c[e+1])?cnArrayProc(c,e,e+1," &#215; 10<sup><b>&#9634;</b></sup>"):cnArrayProc(c,e,e+2," &#215; 10<sup>"+c[e+1]+"</sup>");for(o=0;o<c.length;)"pi"==(A=c[o])?c[o]="&pi;":"e"==A?c[o]="e":"sin"!=A&&"cos"!=A&&"tan"!=A&&"asin"!=A&&"acos"!=A&&"atan"!=A&&"3x"!=A&&"sqrt"!=A&&"ln"!=A&&"log"!=A||("asin"==A?c[o]="arcsin":"acos"==A?c[o]="arccos":"atan"==A?c[o]="arctan":"3x"==A?c[o]="<sup>3</sup>&#8730;":"sqrt"==A&&(c[o]="&#8730;"),c[o]=c[o]+c[o+1],c.splice(o+1,1)),o++;for(var n,a=c.length,o=0;o<a;)"pc"==(A=c[o])?(c[o-1]=c[o-1]+"%",c.splice(o,1),a--):"n!"==A?(!isNaN(c[o-1])&&c[o-1]<0?c[o-1]="("+c[o-1]+")!":c[o-1]=c[o-1]+"!",c.splice(o,1),a--):"x3"==A?("</sup>"==(n=6<(n=c[o-1]+"").length?n.substr(n.length-6):n)||"-"==(c[o-1]+"").substring(0,1)?c[o-1]="("+c[o-1]+")<sup>3</sup>":c[o-1]=c[o-1]+"<sup>3</sup>",c.splice(o,1),a--):"x2"==A?("</sup>"==(n=6<(n=c[o-1]+"").length?n.substr(n.length-6):n)||"-"==(c[o-1]+"").substring(0,1)?c[o-1]="("+c[o-1]+")<sup>2</sup>":c[o-1]=c[o-1]+"<sup>2</sup>",c.splice(o,1),a--):"1/x"==A?(c[o-1]="(1/"+c[o-1]+")",c.splice(o,1),a--):o++;for(;-1<c.lastIndexOf("pow")||-1<c.lastIndexOf("apow")||-1<c.lastIndexOf("ex")||-1<c.lastIndexOf("10x");){var t,s,e=c.lastIndexOf("pow"),i=c.lastIndexOf("apow");(e=(e=e<i?i:e)<(i=c.lastIndexOf("ex"))?i:e)<(i=c.lastIndexOf("10x"))&&(e=i),"pow"==c[e]?(t="","neg"==c[e+1]&&(t="-",c.splice(e+1,1)),"-"==(c[e-1]+(s=i="")).substring(0,1)&&(i="(",s=")"),c[e+1]&&""!=c[e+1]&&")"!=c[e+1]&&"<b>)</b>"!=c[e+1]?(c[e-1]=i+c[e-1]+s+"<sup>"+t+c[e+1]+"</sup>",c.splice(e,2)):(c[e-1]="-"==t?i+c[e-1]+s+"<sup>-</sup>":i+c[e-1]+s+"<sup><b>&#9634;</b></sup>",c.splice(e,1))):"apow"==c[e]?(t="","neg"==c[e+1]&&(t="-",c.splice(e+1,1)),c[e+1]&&""!=c[e+1]&&")"!=c[e+1]&&"<b>)</b>"!=c[e+1]?(c[e-1]="<sup>"+t+c[e+1]+"</sup>&#8730;"+c[e-1],c.splice(e,2)):(c[e-1]="-"==t?"<sup>-</sup>&#8730;"+c[e-1]:"<sup><b>&#9634;</b></sup>&#8730;"+c[e-1],c.splice(e,1))):"ex"==c[e]?(t="","neg"==c[e+1]&&(t="-",c.splice(e+1,1)),c[e+1]&&""!=c[e+1]&&")"!=c[e+1]&&"<b>)</b>"!=c[e+1]?(c[e]="e<sup>"+t+c[e+1]+"</sup>",c.splice(e+1,1)):c[e]="-"==t?"e<sup>-</sup>":"e<sup><b>&#9634;</b></sup>"):"10x"==c[e]&&(t="","neg"==c[e+1]&&(t="-",c.splice(e+1,1)),c[e+1]&&""!=c[e+1]&&")"!=c[e+1]&&"<b>)</b>"!=c[e+1]?(c[e]="10<sup>"+t+c[e+1]+"</sup>",c.splice(e+1,1)):c[e]="-"==t?"10<sup>-</sup>":"10<sup><b>&#9634;</b></sup>")}for(var p="",o=0;o<c.length;o++)A=c[o],isNaN(A)?"*"==A?p+=" &#215; ":"/"==A?p+=" &#247; ":"&times;"==A?p+=" &times; ":"&divide;"==A?p+=" &divide; ":"+"==A?p+=" + ":"-"==A?p+=" &minus; ":"neg"==A?p+=" -":p+=A:p+=A;return p}
function cnCalcResult(crInArray){var crProcArray=crInArray,tempV,tempV,tempV,tempV,tempV,tempV;if(-1<crProcArray.indexOf("Error"))return"Error";for(;-1<crProcArray.indexOf("EXP");){var crFDTemp=crProcArray.indexOf("EXP");if(isNaN(crProcArray[crFDTemp+1]))return"Error";crProcArray[crFDTemp-1]=crProcArray[crFDTemp-1]*Math.pow(10,crProcArray[crFDTemp+1]),crProcArray.splice(crFDTemp,2)}for(i=0;i<crProcArray.length;i++)"pi"==crProcArray[i]&&(crProcArray[i]=Math.PI),"e"==crProcArray[i]&&(crProcArray[i]=Math.E),"("==crProcArray[i]&&(crProcArray.splice(i,1),i--),")"==crProcArray[i]&&(crProcArray.splice(i,1),i--);for(i=0;i<crProcArray.length;i++)if(A=crProcArray[i],"sin"==A||"cos"==A||"tan"==A||"asin"==A||"acos"==A||"atan"==A||"ln"==A||"log"==A||"3x"==A||"sqrt"==A){if(!(i+1<crProcArray.length))return"Error";if(B=crProcArray[i+1],isNaN(B))return"Error";"sin"==A?"degree"==cnDegreeRadians?(tempV=Math.abs(B%180),crProcArray[i]=tempV<1e-13?0:Math.sin(B/180*Math.PI)):(tempV=Math.abs(B/Math.PI-Math.floor(B/Math.PI))*Math.PI,crProcArray[i]=tempV<1e-13?0:Math.sin(B)):"cos"==A?"degree"==cnDegreeRadians?(tempV=Math.abs(B%180),Math.abs(tempV-90)<1e-13?crProcArray[i]=0:crProcArray[i]=Math.cos(B/180*Math.PI)):(tempV=Math.abs(B/Math.PI-Math.floor(B/Math.PI))*Math.PI,Math.abs(tempV-Math.PI/2)<1e-13?crProcArray[i]=0:crProcArray[i]=Math.cos(B)):"tan"==A?"degree"==cnDegreeRadians?(tempV=Math.abs(B%180),tempV<1e-13?crProcArray[i]=0:Math.abs(tempV-90)<1e-13?crProcArray[i]="Error":crProcArray[i]=Math.tan(B/180*Math.PI)):(tempV=Math.abs(B/Math.PI-Math.floor(B/Math.PI))*Math.PI,tempV<1e-13?crProcArray[i]=0:Math.abs(tempV-Math.PI/2)<1e-13?crProcArray[i]="Error":crProcArray[i]=Math.tan(B)):"asin"==A?crProcArray[i]="degree"==cnDegreeRadians?180*Math.asin(B)/Math.PI:Math.asin(B):"acos"==A?crProcArray[i]="degree"==cnDegreeRadians?180*Math.acos(B)/Math.PI:Math.acos(B):"atan"==A?crProcArray[i]="degree"==cnDegreeRadians?180*Math.atan(B)/Math.PI:Math.atan(B):"ln"==A?crProcArray[i]=Math.log(B):"log"==A?crProcArray[i]=Math.log(B)/Math.LN10:"3x"==A?B<0?crProcArray[i]=-1*Math.pow(-1*B,1/3):crProcArray[i]=Math.pow(B,1/3):"sqrt"==A&&(crProcArray[i]=Math.sqrt(B)),crProcArray.splice(i+1,1)}for(;-1<crProcArray.indexOf("1/x")||-1<crProcArray.indexOf("pc")||-1<crProcArray.indexOf("n!")||-1<crProcArray.indexOf("x3")||-1<crProcArray.indexOf("x2");){var j=crProcArray.indexOf("1/x"),k=(j<0&&(j=1e8),crProcArray.indexOf("pc"));-1<k&&k<j&&(j=k),k=crProcArray.indexOf("n!"),-1<k&&k<j&&(j=k),k=crProcArray.indexOf("x3"),-1<k&&k<j&&(j=k),k=crProcArray.indexOf("x2"),-1<k&&k<j&&(j=k),"1/x"==crProcArray[j]?(crProcArray[j-1]=1/crProcArray[j-1],crProcArray.splice(j,1)):"pc"==crProcArray[j]?(crProcArray[j-1]=.01*crProcArray[j-1],crProcArray.splice(j,1)):"n!"==crProcArray[j]?(crProcArray[j-1]=cnFactorial(crProcArray[j-1]),crProcArray.splice(j,1)):"x3"==crProcArray[j]?(crProcArray[j-1]=crProcArray[j-1]*crProcArray[j-1]*crProcArray[j-1],crProcArray.splice(j,1)):"x2"==crProcArray[j]&&(crProcArray[j-1]=crProcArray[j-1]*crProcArray[j-1],crProcArray.splice(j,1))}if(isNaN(crProcArray[crProcArray.length-1]))return"Error";for(;-1<crProcArray.lastIndexOf("pow")||-1<crProcArray.lastIndexOf("apow")||-1<crProcArray.lastIndexOf("ex")||-1<crProcArray.indexOf("10x");){var j=crProcArray.lastIndexOf("pow"),k=crProcArray.lastIndexOf("apow");if(j<k&&(j=k),k=crProcArray.lastIndexOf("ex"),j<k&&(j=k),k=crProcArray.lastIndexOf("10x"),j<k&&(j=k),"10x"==crProcArray[j])"neg"==crProcArray[j+1]?(crProcArray[j]=Math.pow(10,-1*crProcArray[j+2]),crProcArray.splice(j+1,2)):(crProcArray[j]=Math.pow(10,crProcArray[j+1]),crProcArray.splice(j+1,1));else if("ex"==crProcArray[j])"neg"==crProcArray[j+1]?(cr