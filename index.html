<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå (‡∏ò‡∏µ‡∏°‡∏°‡∏∑‡∏î)</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; background: #121212; color: #e0e0e0; }
    header { padding: 20px; text-align: center; background: #1e1e1e; font-size: 1.5rem; border-bottom: 1px solid #333; }
    main { padding: 20px; max-width: 800px; margin: auto; }
    .drop { border: 2px dashed #555; padding: 40px; text-align: center; border-radius: 8px; background: #1e1e1e; cursor: pointer; transition: background 0.2s; }
    .drop.dragover { border-color: #4a90e2; background: #2b2b2b; }
    .btn { background: #4a90e2; border: none; padding: 10px 20px; color: white; border-radius: 4px; cursor: pointer; margin-right: 5px; }
    .btn:hover { background: #357ab8; }
    .file-list { margin-top: 12px; }
    .file-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #1e1e1e; border: 1px solid #333; border-radius: 6px; margin-bottom: 6px; }
    progress { width: 200px; margin-right: 10px; }
    a { color: #4a90e2; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <header>üìÇ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå (‡∏ò‡∏µ‡∏°‡∏°‡∏∑‡∏î)</header>
  <main>
    <div id="drop" class="drop">‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</div>
    <input id="fileInput" type="file" multiple style="display:none" />
    <div style="margin-top: 12px;">
      <button class="btn" id="uploadBtn">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</button>
      <button class="btn" id="refreshBtn">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
    </div>
    <h2>‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</h2>
    <div id="pending" class="file-list"></div>
    <h2>‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ</h2>
    <div id="stored" class="file-list"></div>
  </main>
<script>
  const drop = document.getElementById('drop');
  const fileInput = document.getElementById('fileInput');
  const uploadBtn = document.getElementById('uploadBtn');
  const pending = document.getElementById('pending');
  const stored = document.getElementById('stored');
  const refreshBtn = document.getElementById('refreshBtn');
  let filesToUpload = [];

  function renderPending(){
    pending.innerHTML = '';
    filesToUpload.forEach((f, idx) => {
      const el = document.createElement('div');
      el.className = 'file-item';
      el.innerHTML = `<span>${f.name} (${Math.round(f.size/1024)} KB)</span><progress id="prog-${idx}" value="0" max="100"></progress>`;
      pending.appendChild(el);
    });
  }

  drop.addEventListener('click', ()=> fileInput.click());
  fileInput.addEventListener('change', (e)=> addFiles(e.target.files));
  drop.addEventListener('dragover', (e)=>{ e.preventDefault(); drop.classList.add('dragover'); });
  drop.addEventListener('dragleave', ()=> drop.classList.remove('dragover'));
  drop.addEventListener('drop', (e)=>{
    e.preventDefault(); drop.classList.remove('dragover');
    addFiles(e.dataTransfer.files);
  });

  function addFiles(fileList){
    for(const f of fileList){ filesToUpload.push(f); }
    renderPending();
  }

  uploadBtn.addEventListener('click', async ()=>{
    for(let i=0;i<filesToUpload.length;i++){
      const file = filesToUpload[i];
      const form = new FormData();
      form.append('file', file);
      const prog = document.getElementById('prog-'+i);
      const xhr = new XMLHttpRequest();
      xhr.open('POST', '/upload');
      xhr.upload.onprogress = (ev) => {
        if(ev.lengthComputable) prog.value = (ev.loaded/ev.total)*100;
      };
      xhr.onload = ()=> loadStoredFiles();
      xhr.send(form);
    }
    filesToUpload = [];
    renderPending();
  });

  async function loadStoredFiles(){
    const res = await fetch('/files');
    const list = await res.json();
    stored.innerHTML = '';
    list.forEach(item => {
      const el = document.createElement('div');
      el.className = 'file-item';
      el.innerHTML = `<span>${item.originalName || item.filename} (${Math.round(item.size/1024)} KB)</span><a href="/files/${item.filename}" target="_blank">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</a>`;
      stored.appendChild(el);
    });
  }

  refreshBtn.addEventListener('click', loadStoredFiles);
  loadStoredFiles();
</script>
</body>
</html>