<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>เครื่องคิดเลขวิทยาศาสตร์</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
        :root {
            --bg-color: #000000;
            --panel-bg: #1e1e1e;
            --btn-dark: #333333;
            --btn-light: #505050;
            --btn-accent: #ff9f0a;
            --btn-special: #a6a6a6;
            --text-color: #ffffff;
            --text-accent: #1c1c1c;
            --text-muted: #8e8e93;
            --history-panel-bg: #121212;
        }

        * {
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            background: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px;
            user-select: none;
            flex-direction: column;
            gap: 20px;
        }

        .container {
            display: flex;
            gap: 20px;
            max-width: 1000px;
            width: 100%;
        }

        .calculator {
            background: var(--bg-color);
            border-radius: 20px;
            padding: 10px;
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .display-container {
            display: flex;
            justify-content: flex-end;
            align-items: flex-end;
            flex-direction: column;
            padding: 20px;
            padding-top: 50px;
            min-height: 150px;
            position: relative;
        }

        .display-container::before {
            content: 'Deg';
            position: absolute;
            top: 20px;
            left: 20px;
            color: var(--text-muted);
            font-size: 1rem;
        }

        .display {
            font-size: 3.5rem;
            font-weight: 700;
            text-align: right;
            color: var(--text-color);
            overflow-x: auto;
            white-space: nowrap;
            width: 100%;
        }

        .history-display {
            font-size: 1.5rem;
            color: var(--text-muted);
            text-align: right;
            white-space: nowrap;
            overflow-x: auto;
            width: 100%;
        }

        .buttons {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 10px;
            padding: 10px 0;
        }

        button {
            background: var(--btn-light);
            border: none;
            border-radius: 50%;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-color);
            width: 60px;
            height: 60px;
            cursor: pointer;
            transition: background 0.2s ease, transform 0.1s ease;
        }
        
        button:hover {
            background: var(--btn-special);
        }

        button:active {
            transform: scale(0.95);
        }

        button.num {
            background: var(--btn-light);
        }
        
        button.operator {
            background: var(--btn-accent);
            color: var(--text-color);
        }

        button.operator:hover {
            filter: brightness(1.2);
        }

        button.special {
            background: var(--btn-special);
            color: var(--text-accent);
        }

        button.special:hover {
            filter: brightness(1.2);
        }

        button.equal {
            background: var(--btn-accent);
            color: var(--text-color);
            height: 100%;
            grid-column: 10;
            grid-row: 5 / 7;
            border-radius: 40px;
        }

        button.equal:hover {
            filter: brightness(1.2);
        }

        button.clear-btn {
             background: var(--btn-special);
             color: var(--text-accent);
             grid-column: 5;
        }

        /* History Panel */
        .history-panel {
            background: var(--history-panel-bg);
            border-radius: 12px;
            padding: 20px;
            width: 350px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 600px;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-color);
        }
        
        .history-list {
            flex-grow: 1;
            overflow-y: auto;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .history-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
            padding: 10px;
            background: #2c2c2e;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .history-item:hover {
            background: #4a4a4c;
        }

        .history-expression {
            font-size: 1rem;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .history-result {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .history-clear-btn {
            background: none;
            border: none;
            color: var(--btn-accent);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
        }
        
        /* Mode-specific classes */
        .hidden-sci { display: none; }
        .hidden-std { display: none; }

        .std-mode {
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        .std-mode button {
            width: auto;
            height: 60px;
            border-radius: 50%;
        }
        .std-mode .zero {
            grid-column: span 2;
            border-radius: 30px;
        }
        .std-mode .equal {
            grid-column: auto;
            grid-row: auto;
            height: 60px;
            border-radius: 50%;
        }

        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
            }
            .calculator {
                width: 100%;
            }
            .history-panel {
                width: 100%;
                max-height: 300px;
            }
        }
        
        @media (max-width: 768px) {
            .buttons {
                grid-template-columns: repeat(5, 1fr);
                gap: 8px;
            }
            button {
                width: 100%;
                height: 50px;
                border-radius: 12px;
            }
            button.equal {
                grid-column: 5;
                grid-row: 5 / 7;
                height: 100%;
                border-radius: 12px;
            }
            
            /* Std mode on small screen */
            .std-mode {
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
            }
            .std-mode button {
                width: auto;
                height: 50px;
                border-radius: 12px;
            }
            .std-mode .zero {
                grid-column: span 2;
            }
            .std-mode .equal {
                grid-column: auto;
                grid-row: auto;
                height: 50px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <section class="calculator">
            <div class="display-container">
                <button class="mode-toggle-btn special" id="modeToggleBtn">Std</button>
                <div class="history-display" id="historyDisplay"></div>
                <div class="display" id="display">0</div>
            </div>
            <div class="buttons" id="buttons">
                <button class="special sci-btn" data-value="(" data-action="paren">(</button>
                <button class="special sci-btn" data-value=")" data-action="paren">)</button>
                <button class="special sci-btn" data-value="x^-1" data-action="function">1/x</button>
                <button class="special sci-btn" data-value="mc" data-action="memory">MC</button>
                <button class="special sci-btn" data-value="m-" data-action="memory">M-</button>
                <button class="special sci-btn" data-value="m+" data-action="memory">M+</button>
                <button class="special sci-btn" data-value="mr" data-action="memory">MR</button>
                <button class="special sci-btn" data-value="C" data-action="clear">C</button>
                <button class="operator sci-btn" data-value="/" data-action="operator">÷</button>
                <button class="operator sci-btn" data-action="backspace">⌫</button>

                <button class="special sci-btn" data-value="pow2" data-action="function">x²</button>
                <button class="special sci-btn" data-value="pow3" data-action="function">x³</button>
                <button class="special sci-btn" data-value="powy" data-action="operator">xʸ</button>
                <button class="special sci-btn" data-value="exp" data-action="function">eˣ</button>
                <button class="special sci-btn" data-value="10pow" data-action="function">10ˣ</button>
                <button class="num sci-btn" data-value="7">7</button>
                <button class="num sci-btn" data-value="8">8</button>
                <button class="num sci-btn" data-value="9">9</button>
                <button class="operator sci-btn" data-value="*" data-action="operator">×</button>
                <button class="operator sci-btn" data-value="-" data-action="operator">−</button>

                <button class="special sci-btn" data-value="fact" data-action="function">x!</button>
                <button class="special sci-btn" data-value="sqrt" data-action="function">√</button>
                <button class="special sci-btn" data-value="cbrt" data-action="function">³√</button>
                <button class="special sci-btn" data-value="ln" data-action="function">ln</button>
                <button class="special sci-btn" data-value="log" data-action="function">log</button>
                <button class="num sci-btn" data-value="4">4</button>
                <button class="num sci-btn" data-value="5">5</button>
                <button class="num sci-btn" data-value="6">6</button>
                <button class="operator sci-btn" data-value="+" data-action="operator">+</button>
                
                <button class="special sci-btn" data-value="e">e</button>
                <button class="special sci-btn" data-value="sin" data-action="function">sin</button>
                <button class="special sci-btn" data-value="cos" data-action="function">cos</button>
                <button class="special sci-btn" data-value="tan" data-action="function">tan</button>
                <button class="special sci-btn" data-value="rad">Rad</button>
                <button class="num sci-btn" data-value="1">1</button>
                <button class="num sci-btn" data-value="2">2</button>
                <button class="num sci-btn" data-value="3">3</button>

                <button class="special sci-btn" data-value="pi" data-action="constant">π</button>
                <button class="special sci-btn" data-value="asin" data-action="function">sin⁻¹</button>
                <button class="special sci-btn" data-value="acos" data-action="function">cos⁻¹</button>
                <button class="special sci-btn" data-value="atan" data-action="function">tan⁻¹</button>
                <button class="special sci-btn" data-value="deg">Deg</button>
                <button class="num sci-btn" data-value="0">0</button>
                <button class="num sci-btn" data-value=".">.</button>
                <button class="operator sci-btn equal" data-action="equals">=</button>

                <button class="special std-btn hidden-std" data-action="clear">C</button>
                <button class="operator std-btn hidden-std" data-value="/" data-action="operator">÷</button>
                <button class="operator std-btn hidden-std" data-value="*" data-action="operator">×</button>
                <button class="operator std-btn hidden-std" data-action="backspace">⌫</button>

                <button class="num std-btn hidden-std" data-value="7">7</button>
                <button class="num std-btn hidden-std" data-value="8">8</button>
                <button class="num std-btn hidden-std" data-value="9">9</button>
                <button class="operator std-btn hidden-std" data-value="-" data-action="operator">−</button>

                <button class="num std-btn hidden-std" data-value="4">4</button>
                <button class="num std-btn hidden-std" data-value="5">5</button>
                <button class="num std-btn hidden-std" data-value="6">6</button>
                <button class="operator std-btn hidden-std" data-value="+" data-action="operator">+</button>

                <button class="num std-btn hidden-std" data-value="1">1</button>
                <button class="num std-btn hidden-std" data-value="2">2</button>
                <button class="num std-btn hidden-std" data-value="3">3</button>
                <button class="num std-btn hidden-std" data-value="0" class="zero">0</button>
                <button class="num std-btn hidden-std" data-value=".">.</button>
                <button class="operator std-btn hidden-std" data-action="equals">=</button>
            </div>
        </section>
        
        <aside class="history-panel" id="historyPanel">
            <div class="history-header">
                <span id="historyTitle">ประวัติ</span>
                <button class="history-clear-btn" id="clearHistoryBtn">
                    <span class="history-clear-icon">🗑️</span>
                </button>
            </div>
            <ul class="history-list" id="historyList">
                </ul>
        </aside>
    </div>

    <script>
        const display = document.getElementById('display');
        const historyDisplay = document.getElementById('historyDisplay');
        const buttons = document.getElementById('buttons');
        const historyList = document.getElementById('historyList');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');
        const modeToggleBtn = document.getElementById('modeToggleBtn');
        
        let currentExpression = '';
        let lastResult = '';
        let history = JSON.parse(localStorage.getItem('calculatorHistory') || '[]');
        let currentMode = 'std'; // 'std' or 'sci'

        function toggleMode() {
            if (currentMode === 'std') {
                currentMode = 'sci';
                modeToggleBtn.textContent = 'Std';
                buttons.classList.remove('std-mode');
                document.querySelectorAll('.sci-btn').forEach(btn => btn.classList.remove('hidden-sci'));
                document.querySelectorAll('.std-btn').forEach(btn => btn.classList.add('hidden-std'));
            } else {
                currentMode = 'std';
                modeToggleBtn.textContent = 'Sci';
                buttons.classList.add('std-mode');
                document.querySelectorAll('.sci-btn').forEach(btn => btn.classList.add('hidden-sci'));
                document.querySelectorAll('.std-btn').forEach(btn => btn.classList.remove('hidden-std'));
            }
        }
        
        function updateDisplay() {
            display.textContent = currentExpression || '0';
            historyDisplay.textContent = lastResult;
        }

        function calculate(expression) {
            try {
                // Replace scientific symbols with JS-compatible ones
                let sanitizedExpression = expression
                    .replace(/×/g, '*')
                    .replace(/÷/g, '/')
                    .replace(/−/g, '-');

                // Handle scientific functions
                sanitizedExpression = sanitizedExpression
                    .replace(/sin\(([^)]+)\)/g, 'Math.sin($1 * Math.PI / 180)')
                    .replace(/cos\(([^)]+)\)/g, 'Math.cos($1 * Math.PI / 180)')
                    .replace(/tan\(([^)]+)\)/g, 'Math.tan($1 * Math.PI / 180)')
                    .replace(/log\(([^)]+)\)/g, 'Math.log10($1)')
                    .replace(/ln\(([^)]+)\)/g, 'Math.log($1)')
                    .replace(/√\(([^)]+)\)/g, 'Math.sqrt($1)')
                    .replace(/π/g, 'Math.PI')
                    .replace(/e/g, 'Math.E');

                const result = new Function('return ' + sanitizedExpression)();
                
                if (!isFinite(result)) {
                    return 'Error';
                }

                return Math.round(result * 1e10) / 1e10;
            } catch (error) {
                return 'Error';
            }
        }

        function addToHistory(expression, result) {
            history.unshift({ expr: expression, res: result });
            if (history.length > 50) history.pop();
            localStorage.setItem('calculatorHistory', JSON.stringify(history));
            renderHistory();
        }

        function renderHistory() {
            historyList.innerHTML = '';
            if (history.length === 0) {
                historyList.innerHTML = `<li style="text-align: center; color: var(--text-muted);">ไม่มีประวัติ</li>`;
                return;
            }
            history.forEach((item, index) => {
                const li = document.createElement('li');
                li.className = 'history-item';
                li.innerHTML = `
                    <div class="history-expression">${item.expr}</div>
                    <div class="history-result">${item.res}</div>
                `;
                li.onclick = () => {
                    currentExpression = item.expr;
                    lastResult = item.res;
                    updateDisplay();
                };
                historyList.appendChild(li);
            });
        }
        
        buttons.addEventListener('click', e => {
            const button = e.target.closest('button');
            if (!button) return;

            const value = button.getAttribute('data-value');
            const action = button.getAttribute('data-action');
            
            if (value && action !== 'clear' && action !== 'backspace' && action !== 'equals') {
                if (action === 'operator' && currentExpression === '') {
                    if (value === '-') {
                        currentExpression = value;
                    }
                } else {
                    currentExpression += value;
                }
            }
            
            if (action) {
                switch (action) {
                    case 'clear':
                        currentExpression = '';
                        lastResult = '';
                        break;
                    case 'backspace':
                        currentExpression = currentExpression.slice(0, -1);
                        break;
                    case 'equals':
                        const result = calculate(currentExpression);
                        if (result !== 'Error') {
                            addToHistory(currentExpression, result);
                            lastResult = currentExpression;
                            currentExpression = String(result);
                        } else {
           